import{l as L}from"./game-v6-6msmH.js";import{c as X}from"./ricochet-sound-Cw_wkmHi.js";function Q(y,a){if(!a)return!0;const g=y.name??"";if("name"in a){const f=a.name;return f instanceof RegExp?f.test(g):Array.isArray(f)?f.some(l=>l===g):g===f}else if("mask"in a){const f=a.mask;if(f instanceof RegExp){const l=y.collisionType??"";return f.test(l)}else{const l=y.collisionType??"",c=L(l);return(f&1<<c)!==0}}else if("test"in a)return!!a.test(y);return!0}function et(y={},a){return{type:"collision",handler:g=>{Z(g,y,a)}}}function Z(y,a,g){const{entity:f,other:l}=y,c=f;if(l.collider?.isSensor())return;const{minSpeed:B=2,maxSpeed:H=20,separation:U=0,collisionWith:J=void 0}={...a},T=a?.reflectionMode??"angled",k=a?.maxAngleDeg??60,G=a?.speedUpFactor??1.05,W=a?.minOffsetForAngle??.15,_=a?.centerRetentionFactor??.5;if(!Q(l,J))return;const h=c.getPosition(),q=l.body?.translation(),e=c.getVelocity();if(!h||!q||!e)return;let u=e.x,r=e.y,z=h.x,N=h.y;const E=h.x-q.x,v=h.y-q.y;let n=null,s=null;const b=l.collider?.shape;if(b&&(b.halfExtents&&(n=Math.abs(b.halfExtents.x??b.halfExtents[0]??null),s=Math.abs(b.halfExtents.y??b.halfExtents[1]??null)),(n==null||s==null)&&typeof b.radius=="number"&&(n=n??Math.abs(b.radius),s=s??Math.abs(b.radius))),(n==null||s==null)&&typeof l.collider?.halfExtents=="function"){const t=l.collider.halfExtents();t&&(n=n??Math.abs(t.x),s=s??Math.abs(t.y))}if((n==null||s==null)&&typeof l.collider?.radius=="function"){const t=l.collider.radius();typeof t=="number"&&(n=n??Math.abs(t),s=s??Math.abs(t))}let O=0,R=0;n&&s?(O=X(E/n,-1,1),R=X(v/s,-1,1)):(O=Math.sign(E),R=Math.sign(v));let j=Math.abs(v)>=Math.abs(E),o=null,i=null;const m=c.collider?.shape;if(m&&(m.halfExtents&&(o=Math.abs(m.halfExtents.x??m.halfExtents[0]??null),i=Math.abs(m.halfExtents.y??m.halfExtents[1]??null)),(o==null||i==null)&&typeof m.radius=="number"&&(o=o??Math.abs(m.radius),i=i??Math.abs(m.radius))),(o==null||i==null)&&typeof c.collider?.halfExtents=="function"){const t=c.collider.halfExtents();t&&(o=o??Math.abs(t.x),i=i??Math.abs(t.y))}if((o==null||i==null)&&typeof c.collider?.radius=="function"){const t=c.collider.radius();typeof t=="number"&&(o=o??Math.abs(t),i=i??Math.abs(t))}if(n!=null&&s!=null&&o!=null&&i!=null){const t=o+n-Math.abs(E),d=i+s-Math.abs(v);!Number.isNaN(t)&&!Number.isNaN(d)&&(j=d<=t)}let F=!1;if(j){const t=(s??0)+(i??0)+U;if(N=q.y+(v>0?t:-t),z=h.x,n!=null&&s!=null&&n>s&&T==="angled"){const S=k*Math.PI/180,A=Math.max(0,Math.min(1,W)),D=X(O,-1,1),w=Math.abs(D),Y=Math.sqrt(e.x*e.x+e.y*e.y),M=X(Y*G,B,H);if(w>A){const x=(w-A)/(1-A),p=Math.sign(D)*(x*S),P=Math.cos(p),C=Math.sin(p),I=Math.abs(M*P),K=M*C;r=v>0?I:-I,u=K}else{const x=e.x*_,p=Math.max(0,M*M-x*x),P=Math.sqrt(p);r=v>0?P:-P,u=x}F=!0}else r=v>0?Math.abs(e.y):-Math.abs(e.y),T==="simple"&&(F=!0)}else{const t=(n??0)+(o??0)+U;if(z=q.x+(E>0?t:-t),N=h.y,T==="angled"){const d=k*Math.PI/180,S=Math.max(0,Math.min(1,W)),A=X(R,-1,1),D=Math.abs(A),w=Math.sqrt(e.x*e.x+e.y*e.y),Y=X(w*G,B,H);if(D>S){const M=(D-S)/(1-S),x=Math.sign(A)*(M*d),p=Math.cos(x),P=Math.sin(x),C=Math.abs(Y*p),I=Y*P;u=E>0?C:-C,r=I}else{const M=e.y*_,x=Math.max(0,Y*Y-M*M),p=Math.sqrt(x);u=E>0?p:-p,r=M}F=!0}else u=E>0?Math.abs(e.x):-Math.abs(e.x),r=e.y,F=!0}if(!F){const t=Math.abs(u),d=Math.abs(r),S=Math.sign(O)*Math.abs(O)*t,A=Math.sign(R)*Math.abs(R)*d;u+=S,r+=A}const V=Math.sqrt(u*u+r*r);if(V>0){const t=X(V,B,H);if(t!==V){const d=t/V;u*=d,r*=d}}(z!==h.x||N!==h.y)&&(c.setPosition(z,N,h.z),c.moveXY(u,r),g&&c.getVelocity()&&g({position:{x:z,y:N,z:h.z},...y}))}export{et as r};

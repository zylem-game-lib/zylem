import{C as tt,V as Ct}from"./vendor-three-CRJRX-3r.js";const bt=Object.prototype.hasOwnProperty;function S(t){return Array.isArray(t)}function _(t){return!!t&&typeof t=="object"&&!S(t)}function N(t){return typeof t=="function"}function P(t){const e=typeof t;return t!==void 0&&e!=="object"&&e!=="function"}function ft(t){return typeof t=="boolean"}function lt(t){return t instanceof Promise}function Mt(t){if(!t)return!1;if(S(t))return t.length===0;for(const e in t)if(bt.call(t,e))return!1;return!0}const _t=new Set(["boolean","string","number"]);function Nt(t){return _t.has(typeof t)}function T(t){return!!t.parent}const xt=Symbol.toPrimitive,H=Symbol("getNode"),at=Symbol("delete"),U=Symbol("opaque"),Y=Symbol("optimized"),Ft=new Map,et=new Map;function Z(t){const e=t.root,i=e.activate;i&&(e.activate=void 0,i())}function It(t){return t&&t[H]}function ut(t,e){return L(t)}function L(t){return Z(t),v(t)}const it=[];function v(t){let e=0,i=t;for(;T(i);)it[e++]=i.key,i=i.parent;let s=t.root._;for(let n=e-1;s&&n>=0;n--){const r=it[n];s=s instanceof Map||s instanceof WeakMap?s.get(r):s[r]}return s}function M(t,e){var i;let s=(i=t.children)===null||i===void 0?void 0:i.get(e);return s||(s={root:t.root,parent:t,key:e},t.children||(t.children=new Map),t.children.set(e,s)),s}function gt(t){let e=v(t);if(!e)if(T(t)){const i=gt(t.parent);e=i[t.key]={}}else e=t.root._={};return e}function wt(t,e){let i=_(t)?"id"in t?"id":"key"in t?"key":"_id"in t?"_id":"__id"in t?"__id":void 0:void 0;if(!i&&e.parent){const s=v(e.parent)[e.key+"_keyExtractor"];s&&N(s)&&(i=s)}return i}function nt(t,e,i){t.functions||(t.functions=new Map),t.functions.set(i,e[i])}function ht(t,e){for(const i in t){const s=t[i];if(typeof s=="function")nt(e,t,i);else if(typeof s=="object"&&s!==null&&s!==void 0){const n=It(s);n?.isComputed?nt(e,t,i):ht(t[i],M(e,i))}}}let F,I=0,J=!1,Q=!1,st=[],B=new Map;function Bt(){B.size>0&&K(!0)}function Dt(t,e){let i=t?JSON.parse(JSON.stringify(t)):{};for(let s=0;s<e.length;s++){const{path:n,prevAtPath:r}=e[s];let f=i;if(n.length>0){let o;for(o=0;o<n.length-1;o++)f=f[n[o]];f[n[o]]=r}else i=r}return i}function Ot(t,e){return function(){return Dt(t,e)}}function w(t,e,i,s,n){const r=new Map;j(r,t,e,[],[],e,i,!0,s,n),dt(r,!0);const f=B.get(t);f?f.value=e:B.set(t,{value:e,prev:i,level:s,whenOptimizedOnlyIf:n}),I<=0&&yt()}function rt(t,e,i,s,n,r,f,o,l,a){if(o?e.listenersImmediate:e.listeners){const c={path:s,pathTypes:n,valueAtPath:r,prevAtPath:f},u=t.get(e);u&&s.length>0?u.changes.push(c):t.set(e,{level:l,value:i,whenOptimizedOnlyIf:a,changes:[c]})}}function j(t,e,i,s,n,r,f,o,l,a){if(rt(t,e,i,s,n,r,f,o,l,a),e.linkedFromNodes)for(const c of e.linkedFromNodes)rt(t,c,i,s,n,r,f,o,l,a);if(e.parent){const c=e.parent;if(c){const u=v(c);j(t,c,u,[e.key].concat(s),[S(i)?"array":"object"].concat(n),r,f,o,l+1,a)}}}function dt(t,e){const i=new Set;t.forEach(({changes:s,level:n,value:r,whenOptimizedOnlyIf:f},o)=>{const l=e?o.listenersImmediate:o.listeners;if(l){let a;const c=Array.from(l);for(let u=0;u<c.length;u++){const p=c[u],{track:d,noArgs:h,listener:g}=p;i.has(g)||(d===!0||d==="shallow"?n<=0:d!==Y||f&&n<=0)&&(!h&&!a&&(a={value:r,getPrevious:Ot(r,s),changes:s}),d||i.add(g),g(a))}}})}function yt(){const t=B;B=new Map;const e=new Map;t.forEach(({value:i,prev:s,level:n,whenOptimizedOnlyIf:r},f)=>{j(e,f,i,[],[],i,s,!1,n,r)}),dt(e,!1)}function mt(){I++,F||(F=setTimeout(Bt,0))}function K(t){if(I--,I<=0||t)if(J)Q=!0;else{F&&(clearTimeout(F),F=void 0),I=0;const e=st;e.length&&(st=[]),J=!0,yt(),J=!1;for(let i=0;i<e.length;i++)e[i]();Q&&(Q=!1,K(!0))}}function pt(t,e,i={}){const{initial:s,immediate:n,noArgs:r}=i;let{trackingType:f}=i;f==="optimize"&&(f=Y);let o=n?t.listenersImmediate:t.listeners;o||(o=new Set,n?t.listenersImmediate=o:t.listeners=o),Z(t);const l={listener:e,track:f,noArgs:r};o.add(l);let a=t.parent;for(;a&&!a.descendantHasListener;)a.descendantHasListener=!0,a=a.parent;if(s){const c=v(t);e({value:c,changes:[{path:[],pathTypes:[],prevAtPath:c,valueAtPath:c}],getPrevious:()=>{}})}return()=>o.delete(l)}const Et=new Set(["copyWithin","fill","from","pop","push","reverse","shift","sort","splice","unshift"]),Rt=new Set(["every","filter","find","findIndex","forEach","includes","join","map","some"]),Tt=new Set(["filter","find"]),ot=new Map,vt=new Map([["get",ut],["set",D],["peek",L],["onChange",pt],["assign",Kt],["delete",$t],["toggle",Lt]]);function Ht(t,e,i,...s){var n;const r=S(e)&&e.slice()||e,f=e[i].apply(e,s);if(t){const o=T(t),l=o?t.key:"_",a=o?v(t.parent):t.root;a[l]=r,O((n=t.parent)!==null&&n!==void 0?n:t,l,e)}return f}function X(t,e,i){if(_(e)&&e[U]||_(i)&&i[U]){const d=e!==i;return d&&(t.listeners||t.listenersImmediate)&&w(t,e,i,0),d}const s=S(e);let n,r;const f=e instanceof Map,o=e?f?Array.from(e.keys()):Object.keys(e):[],l=i?f?Array.from(i.keys()):Object.keys(i):[];let a,c,u=!1,p;if(s&&S(i)){if(i.length>0){const d=i[0];if(d!==void 0&&(a=wt(d,t),a&&(c=N(a),n=new Map,r=[],t.children)))for(let h=0;h<i.length;h++){const g=i[h];if(g){const y=t.children.get(h+"");if(y){const m=c?a(g):g[a];n.set(m,y)}}}}}else if(i&&(!e||_(e))){const d=l.length;for(let h=0;h<d;h++){const g=l[h];if(!o.includes(g)){u=!0;const y=M(t,g),m=f?i.get(g):i[g];m!==void 0&&(P(m)||X(y,void 0,m),(y.listeners||y.listenersImmediate)&&w(y,void 0,m,0))}}}if(e&&!P(e)){const d=o.length;u=u||o?.length!==l?.length;const h=u;let g=!1;if(t.descendantHasListener||!u){for(let y=0;y<d;y++){const m=o[y],k=f?e.get(m):e[m],G=f?i?.get(m):i?.[m];let x=k!==G;if(x){const q=a&&k?c?a(k):k[a]:void 0;let A=M(t,m);if(s&&q!==void 0){const b=q!==void 0?n?.get(q):void 0;if(!b)x=!1,u=!0;else if(b!==void 0&&b.key!==m){const At=i[b.key];h&&(A=b,t.children.delete(A.key),A.key=m,r.push([m,A])),g=!0,x=At!==k}}if(x)if(P(k))u=!0;else{const b=(!u||!!A.descendantHasListener)&&X(A,k,G);u=u||b}(x||!h)&&(A.listeners||A.listenersImmediate)&&w(A,k,G,0,!h)}}if(r)for(let y=0;y<r.length;y++){const[m,k]=r[y];t.children.set(m,k)}}p=u||g}else i!==void 0&&(p=!0);return p??!1}function C(t,e){return e!==void 0&&(t=M(t,e)),t.proxy||(t.proxy=new Proxy(t,kt))}const kt={get(t,e,i){var s;if(e===xt)throw new Error("[legend-state] observable is not a primitive.");if(e===H)return t;if(t.isComputed){if(t.proxyFn)return t.proxyFn(e);Z(t)}if(t.linkedToNode&&e!=="onChange")return kt.get(t.linkedToNode,e,i);const n=L(t);if(n instanceof Map||n instanceof WeakMap||n instanceof Set||n instanceof WeakSet){const c=zt(t,e,n);if(c!==void 0)return c}const r=vt.get(e);if(r)return function(c,u,p){switch(arguments.length){case 0:return r(t);case 1:return r(t,c);case 2:return r(t,c,u);default:return r(t,c,u,p)}};const f=ot.get(e);if(f)return f.get(t);const o=P(n);if((n==null||o)&&et.size&&(t.isActivatedPrimitive||Ft.has(e))){t.isActivatedPrimitive=!0;const c=et.get(e);if(c!==void 0)return N(c)?c(C(t)):c}const l=n?.[e];if(_(n)&&n[U])return l;if(N(l)){if(S(n)){if(Et.has(e))return(...c)=>Ht(t,n,e,...c);if(Rt.has(e))return function(c,u){function p(d,h,g){return c(C(t,h+""),h,g)}if(Tt.has(e)){const d=e==="find",h=[];for(let g=0;g<n.length;g++)if(p(n[g],g,n)){const y=C(t,g+"");if(d)return y;h.push(y)}return d?void 0:h}else return n[e](p,u)}}return l.bind(n)}if(P(l)&&S(n)&&e==="length")return l;const a=(s=t.functions)===null||s===void 0?void 0:s.get(e);return a||C(t,e)},getPrototypeOf(t){const e=v(t);return e!==null&&typeof e=="object"?Reflect.getPrototypeOf(e):null},ownKeys(t){const e=v(t);if(P(e))return[];const i=e?Reflect.ownKeys(e):[];return S(e)&&i[i.length-1]==="length"&&i.splice(i.length-1,1),i},getOwnPropertyDescriptor(t,e){const i=v(t);return P(i)?void 0:Reflect.getOwnPropertyDescriptor(i,e)},set(t,e,i){if(t.isSetting)return Reflect.set(t,e,i);if(t.isAssigning)return O(t,e,i),!0;const s=ot.get(e);return s?(s.set(t,i),!0):!1},deleteProperty(t,e){return t.isSetting?Reflect.deleteProperty(t,e):!1},has(t,e){const i=v(t);return Reflect.has(i,e)}};function D(t,e){if(lt(e))e.then(i=>D(t,i)).catch(i=>D(t,{error:i}));else return t.parent?O(t.parent,t.key,e):O(t,"_",e)}function Lt(t){const e=v(t);if(e===void 0||ft(e))return D(t,!e),!e}function O(t,e,i,s){if(t.root.locked&&!t.root.set)throw new Error("[legend-state] Modified locked observable");const n=i===at;n&&(i=void 0);const r=!t.parent&&e==="_",f=r?t:M(t,e),o=r?t.root:gt(t),l=o[e],a=N(i);i=!t.isAssigning&&a?i(l):_(i)&&i?.[H]?i.peek():i;const c=P(i)||i instanceof Date;try{t.isSetting=(t.isSetting||0)+1,n?delete o[e]:o[e]=i}finally{t.isSetting--}return t.root.locked&&t.root.set&&t.root.set(t.root._),i!==l&&R(t,i,l,f,c,r,s),a?i:r?C(t):C(t,e)}function Kt(t,e){const i=C(t);mt(),P(t.root._)&&(t.root._={}),t.isAssigning=(t.isAssigning||0)+1;try{Object.assign(i,e)}finally{t.isAssigning--}return K(),i}function $t(t,e){e===void 0&&T(t)&&(e=t.key,t=t.parent),O(t,e??"_",at,-1)}function zt(t,e,i){const s=i?.[e];if(N(s))return function(n,r,f){const o=arguments.length,l=i;if(e==="get"){if(o>0&&typeof n!="boolean"&&n!==Y)return C(t,n)}else if(e==="set"){if(o===2){const c=l.get(n),u=l.set(n,r);return c!==r&&R(M(t,n),r,c),u}}else if(e==="delete"){if(o>0){const c=i.get?l.get(n):n,u=i.delete(n);return u&&R(M(t,n),void 0,c),u}}else if(e==="clear"){const c=new Map(l),u=l.size;l.clear(),u&&R(t,i,c);return}else if(e==="add"){const c=new Set(i),u=i.add(n);return i.has(e)||w(t,u,c,0),u}const a=vt.get(e);if(a)switch(o){case 0:return a(t);case 1:return a(t,n);case 2:return a(t,n,r);default:return a(t,n,r,f)}else return i[e](n,r)}}function R(t,e,i,s,n,r,f){s||(s=t),mt();let o=n,l=!1;(!n||i&&!P(i))&&(o=X(s,e,i),S(e)&&(l=e?.length!==i?.length)),(n||!e||Mt(e)?e!==i:o)&&w(n&&r?t:s,e,i,f??i===void 0?-1:o?0:1,l),K()}const ct=["get","set","peek","onChange","toggle"];function E(t){this._node=t;for(let e=0;e<ct.length;e++){const i=ct[e];this[i]=this[i].bind(this)}}function $(t,e){E.prototype[t]=function(...i){return e.call(this,this._node,...i)}}$("peek",L);$("get",ut);$("set",D);$("onChange",pt);Object.defineProperty(E.prototype,H,{configurable:!0,get(){return this._node}});E.prototype.toggle=function(){const t=this.peek();return(t===void 0||ft(t))&&this.set(!t),!t};E.prototype.delete=function(){return this.set(void 0),this};function Wt(t,e){const i=lt(t),n={root:{_:i?void 0:t}},r=Nt(t),f=r?new E(n):C(n);return i?(t.catch(o=>{f.set({error:o})}),t.then(o=>{f.set(o)})):r||t&&ht(t,n),f}function z(t){return Wt(t)}const Pt=z({on:!1,configuration:{showCollisionBounds:!1,showModelBounds:!1,showSpriteBounds:!1}}),qt=Pt.get(),Jt=(t=!1)=>{Pt.on.set(t)},St=z({id:"",globals:{},time:0,elements:{hud:null,game:null}}),Qt=t=>{St.globals.set(t)},Ut=()=>St.globals.get(),W=z({backgroundColor:new tt(tt.NAMES.cornflowerblue),backgroundImage:null,inputs:{p1:["gamepad-1","keyboard-1"],p2:["gamepad-2","keyboard-2"]},variables:{},gravity:new Ct(0,0,0),entities:[]}),Xt=W.get(),Yt=t=>{W.backgroundColor.set(t)},Zt=t=>{W.backgroundImage.set(t)},jt=t=>{W.entities.set(t)},V=z({messages:[]}),Vt=t=>{const i=`[${new Date().toLocaleTimeString()}] ${t}`;V.messages.push(i)},te=()=>{V.messages.set([])},ee=()=>V.messages.get().join(`
`);export{Jt as a,St as b,Xt as c,qt as d,Yt as e,Zt as f,jt as g,Pt as h,Ut as i,V as j,ee as k,te as l,Vt as p,Qt as s};
